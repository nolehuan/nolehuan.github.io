{"title":"ptp","uid":"6c7ebfa27e3441c41e8e3de672151141","slug":"linux/ptp","date":"2023-11-29T21:26:29.000Z","updated":"2023-12-10T07:28:50.068Z","comments":true,"path":"api/articles/linux/ptp.json","cover":null,"content":"<h4 id=\"时钟\"><a href=\"#时钟\" class=\"headerlink\" title=\"时钟\"></a>时钟</h4><ul>\n<li><p>UNIX 从1970年1月1日开始所经过的秒数</p>\n</li>\n<li><p>CLOCK_REALTIME 系统实时时间，UNIX 时间</p>\n</li>\n<li><p>CLOCK_MONOTONIC 系统单调时间，系统启动后经过的秒数</p>\n</li>\n</ul>\n<h4 id=\"查看硬件支持\"><a href=\"#查看硬件支持\" class=\"headerlink\" title=\"查看硬件支持\"></a>查看硬件支持</h4><p><code>ifconfig</code> 查看网卡</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta prompt_\">$ </span><span class=\"language-bash\">ifconfig</span></span><br><span class=\"line\">lo: flags=73&lt;UP,LOOPBACK,RUNNING&gt;  mtu 65536</span><br><span class=\"line\">        inet 127.0.0.1  netmask 255.0.0.0</span><br><span class=\"line\">        inet6 ::1  prefixlen 128  scopeid 0x10&lt;host&gt;</span><br><span class=\"line\">        loop  txqueuelen 1000  (Local Loopback)</span><br><span class=\"line\">        RX packets 1500  bytes 180446 (180.4 KB)</span><br><span class=\"line\">        RX errors 0  dropped 0  overruns 0  frame 0</span><br><span class=\"line\">        TX packets 1500  bytes 180446 (180.4 KB)</span><br><span class=\"line\">        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0</span><br><span class=\"line\"></span><br><span class=\"line\">wlp0s20f3: flags=4163&lt;UP,BROADCAST,RUNNING,MULTICAST&gt;  mtu 1500</span><br><span class=\"line\">        inet 192.168.99.101  netmask 255.255.255.0  broadcast 192.168.99.255</span><br><span class=\"line\">        inet6 fe80::f40b:3351:553f:66ba  prefixlen 64  scopeid 0x20&lt;link&gt;</span><br><span class=\"line\">        ether 08:71:90:3c:dc:05  txqueuelen 1000  (Ethernet)</span><br><span class=\"line\">        RX packets 34174  bytes 42219505 (42.2 MB)</span><br><span class=\"line\">        RX errors 0  dropped 0  overruns 0  frame 0</span><br><span class=\"line\">        TX packets 16487  bytes 2915006 (2.9 MB)</span><br><span class=\"line\">        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0</span><br></pre></td></tr></table></figure>\n<p><code>ethtool -T wlp0s20f3</code> 查看网卡是否支持 PTP 同步</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta prompt_\">$ </span><span class=\"language-bash\">ethtool -T wlp0s20f3</span></span><br><span class=\"line\">Time stamping parameters for wlp0s20f3:</span><br><span class=\"line\">Capabilities:</span><br><span class=\"line\">\tsoftware-receive      (SOF_TIMESTAMPING_RX_SOFTWARE)</span><br><span class=\"line\">\tsoftware-system-clock (SOF_TIMESTAMPING_SOFTWARE)</span><br><span class=\"line\">PTP Hardware Clock: none</span><br><span class=\"line\">Hardware Transmit Timestamp Modes: none</span><br><span class=\"line\">Hardware Receive Filter Modes: none</span><br></pre></td></tr></table></figure>\n<p>PTP Hardware Clock: none 网卡不支持 PTP 同步</p>\n<h4 id=\"PTP-同步\"><a href=\"#PTP-同步\" class=\"headerlink\" title=\"PTP 同步\"></a>PTP 同步</h4><p>开始同步前建议关闭 WIFI</p>\n<ul>\n<li>主钟</li>\n</ul>\n<p><code>sudo ptp4l -i eno1 -m -H</code><br><code>-i</code> 网卡设备<br><code>-m</code> 将消息打印到标准输出<br><code>-H</code> 硬件时间戳</p>\n<p><code>sudo phc2sys -c eno1 -s CLOCK_REALTIME -w -m</code> 将系统时钟同步到网卡的 PTP 硬件时钟<br><code>-c</code> 从时钟，默认 CLOCK_REALTIME<br><code>-s</code> 主时钟<br><code>-w</code> 等待 ptp4l<br><code>-m</code> 将消息打印到标准输出</p>\n<ul>\n<li>从钟</li>\n</ul>\n<p><code>sudo ptp4l -i eno1 -m -H -s</code><br><code>-s</code> 从时钟模式</p>\n<p><code>sudo phc2sys -s eno1 -w -m</code> 将网卡的 PTP 硬件时钟同步到系统时钟</p>\n","feature":false,"text":"ptp...","permalink":"/post/linux/ptp","photos":[],"count_time":{"symbolsCount":"1.7k","symbolsTime":"2 mins."},"categories":[{"name":"tool","slug":"tool","count":1,"path":"api/categories/tool.json"}],"tags":[{"name":"time","slug":"time","count":1,"path":"api/tags/time.json"}],"toc":"<ol class=\"toc\"><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#%E6%97%B6%E9%92%9F\"><span class=\"toc-text\">时钟</span></a></li><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#%E6%9F%A5%E7%9C%8B%E7%A1%AC%E4%BB%B6%E6%94%AF%E6%8C%81\"><span class=\"toc-text\">查看硬件支持</span></a></li><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#PTP-%E5%90%8C%E6%AD%A5\"><span class=\"toc-text\">PTP 同步</span></a></li></ol>","author":{"name":"NoleHuan","slug":"blog-author","avatar":"/img/tennis_logo.svg","link":"/","description":"The true nature of a heart is seen in its response to the unattractive.","socials":{"github":"https://github.com/nolehuan","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"https://weibo.com/u/5948495997","zhihu":"","csdn":"","juejin":"","customs":{}}},"mapped":true,"hidden":false,"prev_post":{"title":"strip","uid":"a411c58a70d71608d7e89379b3a77f8e","slug":"linux/strip","date":"2023-11-30T21:20:29.000Z","updated":"2023-12-03T04:57:10.204Z","comments":true,"path":"api/articles/linux/strip.json","cover":null,"text":"动态库裁剪...","permalink":"/post/linux/strip","photos":[],"count_time":{"symbolsCount":"46k","symbolsTime":"42 mins."},"categories":[{"name":"script","slug":"script","count":2,"path":"api/categories/script.json"}],"tags":[{"name":"shell","slug":"shell","count":2,"path":"api/tags/shell.json"},{"name":"so","slug":"so","count":2,"path":"api/tags/so.json"}],"author":{"name":"NoleHuan","slug":"blog-author","avatar":"/img/tennis_logo.svg","link":"/","description":"The true nature of a heart is seen in its response to the unattractive.","socials":{"github":"https://github.com/nolehuan","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"https://weibo.com/u/5948495997","zhihu":"","csdn":"","juejin":"","customs":{}}},"feature":false},"next_post":{"title":"shell","uid":"ce97a94626317b127a6da02030ff4c21","slug":"linux/shell","date":"2023-11-28T21:30:29.000Z","updated":"2023-12-24T02:40:40.253Z","comments":true,"path":"api/articles/linux/shell.json","cover":null,"text":"shell...","permalink":"/post/linux/shell","photos":[],"count_time":{"symbolsCount":"25k","symbolsTime":"23 mins."},"categories":[{"name":"script","slug":"script","count":2,"path":"api/categories/script.json"}],"tags":[{"name":"shell","slug":"shell","count":2,"path":"api/tags/shell.json"}],"author":{"name":"NoleHuan","slug":"blog-author","avatar":"/img/tennis_logo.svg","link":"/","description":"The true nature of a heart is seen in its response to the unattractive.","socials":{"github":"https://github.com/nolehuan","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"https://weibo.com/u/5948495997","zhihu":"","csdn":"","juejin":"","customs":{}}},"feature":false}}