{"title":"elf","uid":"e0bcc7841199a311c03a49e060ae24e8","slug":"linux/elf","date":"2023-12-23T17:40:29.000Z","updated":"2023-12-24T03:05:28.084Z","comments":true,"path":"api/articles/linux/elf.json","cover":[],"content":"<h4 id=\"demo\"><a href=\"#demo\" class=\"headerlink\" title=\"demo\"></a>demo</h4><figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"type\">int</span> <span class=\"title function_\">printf</span><span class=\"params\">(<span class=\"type\">const</span> <span class=\"type\">char</span>* format, ...)</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"type\">int</span> global_init_var = <span class=\"number\">84</span>;</span><br><span class=\"line\"><span class=\"type\">int</span> global_uninit_var;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"type\">void</span> <span class=\"title function_\">func</span><span class=\"params\">(<span class=\"type\">int</span> i)</span> &#123;</span><br><span class=\"line\">  <span class=\"built_in\">printf</span>(<span class=\"string\">&quot;%d\\n&quot;</span>, i);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"type\">int</span> <span class=\"title function_\">main</span><span class=\"params\">(<span class=\"type\">void</span>)</span> &#123;</span><br><span class=\"line\">  <span class=\"type\">static</span> <span class=\"type\">int</span> static_var = <span class=\"number\">85</span>;</span><br><span class=\"line\">  <span class=\"type\">static</span> <span class=\"type\">int</span> static_uninit_var;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"type\">int</span> a = <span class=\"number\">1</span>;</span><br><span class=\"line\">  <span class=\"type\">int</span> b;</span><br><span class=\"line\"></span><br><span class=\"line\">  func(static_var + static_uninit_var + a + b);</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">return</span> a;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta prompt_\">$ </span><span class=\"language-bash\">gcc -c SimpleSection.c</span></span><br><span class=\"line\"><span class=\"meta prompt_\">$ </span><span class=\"language-bash\">objdump -h SimpleSection.o</span> </span><br><span class=\"line\"></span><br><span class=\"line\">SimpleSection.o:     file format elf64-x86-64</span><br><span class=\"line\"></span><br><span class=\"line\">Sections:</span><br><span class=\"line\">Idx Name          Size      VMA               LMA               File off  Algn</span><br><span class=\"line\">  0 .text         00000057  0000000000000000  0000000000000000  00000040  2**0</span><br><span class=\"line\">                  CONTENTS, ALLOC, LOAD, RELOC, READONLY, CODE</span><br><span class=\"line\">  1 .data         00000008  0000000000000000  0000000000000000  00000098  2**2</span><br><span class=\"line\">                  CONTENTS, ALLOC, LOAD, DATA</span><br><span class=\"line\">  2 .bss          00000004  0000000000000000  0000000000000000  000000a0  2**2</span><br><span class=\"line\">                  ALLOC</span><br><span class=\"line\">  3 .rodata       00000004  0000000000000000  0000000000000000  000000a0  2**0</span><br><span class=\"line\">                  CONTENTS, ALLOC, LOAD, READONLY, DATA</span><br><span class=\"line\">  4 .comment      0000002a  0000000000000000  0000000000000000  000000a4  2**0</span><br><span class=\"line\">                  CONTENTS, READONLY</span><br><span class=\"line\">  5 .note.GNU-stack 00000000  0000000000000000  0000000000000000  000000ce  2**0</span><br><span class=\"line\">                  CONTENTS, READONLY</span><br><span class=\"line\">  6 .eh_frame     00000058  0000000000000000  0000000000000000  000000d0  2**3</span><br><span class=\"line\">                  CONTENTS, ALLOC, LOAD, RELOC, READONLY, DATA</span><br><span class=\"line\"><span class=\"meta prompt_\">$ </span><span class=\"language-bash\">size SimpleSection.o</span> </span><br><span class=\"line\">   text\t   data\t    bss\t    dec\t    hex\tfilename</span><br><span class=\"line\">    179\t      8\t      4\t    191\t     bf\tSimpleSection.o</span><br></pre></td></tr></table></figure>\n<div align=\"center\">\n  <img src=\"/img/elf.png\">\n</div>\n\n<p><code>.text</code> 代码段<br><code>.data</code> 数据段，保存已初始化的全局变量global_init_var和局部静态变量static_var<br><code>.bss</code> BSS段，为未初始化的全局变量global_uninit_var和局部静态变量static_uninit_var预留空间，不存储变量<br><code>.rodata</code> 只读数据段，保存字符串常量”%d\\n”和只读变量const<br><code>.comment</code> 注释信息段<br><code>.note.GNU-stack</code> 堆栈提示段<br><code>CONTENTS</code> 表示在文件中存在<br><code>Size</code> 段的长度<br><code>File off</code> 段的位置</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta prompt_\">$ </span><span class=\"language-bash\">objdump -s -d SimpleSection.o</span> </span><br><span class=\"line\"></span><br><span class=\"line\">SimpleSection.o:     file format elf64-x86-64</span><br><span class=\"line\"></span><br><span class=\"line\">Contents of section .text:</span><br><span class=\"line\"> 0000 554889e5 4883ec10 897dfc8b 45fc89c6  UH..H....&#125;..E...</span><br><span class=\"line\"> 0010 488d3d00 000000b8 00000000 e8000000  H.=.............</span><br><span class=\"line\"> 0020 0090c9c3 554889e5 4883ec10 c745f801  ....UH..H....E..</span><br><span class=\"line\"> 0030 0000008b 15000000 008b0500 00000001  ................</span><br><span class=\"line\"> 0040 c28b45f8 01c28b45 fc01d089 c7e80000  ..E....E........</span><br><span class=\"line\"> 0050 00008b45 f8c9c3                      ...E...         </span><br><span class=\"line\">Contents of section .data:</span><br><span class=\"line\"> 0000 54000000 55000000                    T...U...        </span><br><span class=\"line\">Contents of section .rodata:</span><br><span class=\"line\"> 0000 25640a00                             %d..            </span><br><span class=\"line\">Contents of section .comment:</span><br><span class=\"line\"> 0000 00474343 3a202855 62756e74 7520372e  .GCC: (Ubuntu 7.</span><br><span class=\"line\"> 0010 352e302d 33756275 6e747531 7e31382e  5.0-3ubuntu1~18.</span><br><span class=\"line\"> 0020 30342920 372e352e 3000               04) 7.5.0.      </span><br><span class=\"line\">Contents of section .eh_frame:</span><br><span class=\"line\"> 0000 14000000 00000000 017a5200 01781001  .........zR..x..</span><br><span class=\"line\"> 0010 1b0c0708 90010000 1c000000 1c000000  ................</span><br><span class=\"line\"> 0020 00000000 24000000 00410e10 8602430d  ....$....A....C.</span><br><span class=\"line\"> 0030 065f0c07 08000000 1c000000 3c000000  ._..........&lt;...</span><br><span class=\"line\"> 0040 00000000 33000000 00410e10 8602430d  ....3....A....C.</span><br><span class=\"line\"> 0050 066e0c07 08000000                    .n......        </span><br><span class=\"line\"></span><br><span class=\"line\">Disassembly of section .text:</span><br><span class=\"line\"></span><br><span class=\"line\">0000000000000000 &lt;func&gt;:</span><br><span class=\"line\">   0:\t55                   \tpush   %rbp</span><br><span class=\"line\">   1:\t48 89 e5             \tmov    %rsp,%rbp</span><br><span class=\"line\">   4:\t48 83 ec 10          \tsub    $0x10,%rsp</span><br><span class=\"line\">   8:\t89 7d fc             \tmov    %edi,-0x4(%rbp)</span><br><span class=\"line\">   b:\t8b 45 fc             \tmov    -0x4(%rbp),%eax</span><br><span class=\"line\">   e:\t89 c6                \tmov    %eax,%esi</span><br><span class=\"line\">  10:\t48 8d 3d 00 00 00 00 \tlea    0x0(%rip),%rdi        # 17 &lt;func+0x17&gt;</span><br><span class=\"line\">  17:\tb8 00 00 00 00       \tmov    $0x0,%eax</span><br><span class=\"line\">  1c:\te8 00 00 00 00       \tcallq  21 &lt;func+0x21&gt;</span><br><span class=\"line\">  21:\t90                   \tnop</span><br><span class=\"line\">  22:\tc9                   \tleaveq </span><br><span class=\"line\">  23:\tc3                   \tretq   </span><br><span class=\"line\"></span><br><span class=\"line\">0000000000000024 &lt;main&gt;:</span><br><span class=\"line\">  24:\t55                   \tpush   %rbp</span><br><span class=\"line\">  25:\t48 89 e5             \tmov    %rsp,%rbp</span><br><span class=\"line\">  28:\t48 83 ec 10          \tsub    $0x10,%rsp</span><br><span class=\"line\">  2c:\tc7 45 f8 01 00 00 00 \tmovl   $0x1,-0x8(%rbp)</span><br><span class=\"line\">  33:\t8b 15 00 00 00 00    \tmov    0x0(%rip),%edx        # 39 &lt;main+0x15&gt;</span><br><span class=\"line\">  39:\t8b 05 00 00 00 00    \tmov    0x0(%rip),%eax        # 3f &lt;main+0x1b&gt;</span><br><span class=\"line\">  3f:\t01 c2                \tadd    %eax,%edx</span><br><span class=\"line\">  41:\t8b 45 f8             \tmov    -0x8(%rbp),%eax</span><br><span class=\"line\">  44:\t01 c2                \tadd    %eax,%edx</span><br><span class=\"line\">  46:\t8b 45 fc             \tmov    -0x4(%rbp),%eax</span><br><span class=\"line\">  49:\t01 d0                \tadd    %edx,%eax</span><br><span class=\"line\">  4b:\t89 c7                \tmov    %eax,%edi</span><br><span class=\"line\">  4d:\te8 00 00 00 00       \tcallq  52 &lt;main+0x2e&gt;</span><br><span class=\"line\">  52:\t8b 45 f8             \tmov    -0x8(%rbp),%eax</span><br><span class=\"line\">  55:\tc9                   \tleaveq </span><br><span class=\"line\">  56:\tc3                   \tretq</span><br></pre></td></tr></table></figure>\n<p><code>-s</code> 以十六进制打印所有段的内容<br><code>-d</code> 将所有包含指令的段反汇编<br><code>-x</code> 显示所有头信息</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta prompt_\">$ </span><span class=\"language-bash\">objdump -x -s -d SimpleSection.o</span></span><br><span class=\"line\">...</span><br><span class=\"line\">Contents of section .data:</span><br><span class=\"line\"> 0000 54000000 55000000                    T...U...        </span><br><span class=\"line\">Contents of section .rodata:</span><br><span class=\"line\"> 0000 25640a00                             %d..</span><br><span class=\"line\">...</span><br></pre></td></tr></table></figure>\n<p><code>.data</code> 段的前四个字节54000000（小端存储）即global_init_var=84</p>\n","feature":true,"text":"layout...","permalink":"/post/linux/elf","photos":[],"count_time":{"symbolsCount":"4.9k","symbolsTime":"4 mins."},"categories":[{"name":"linux","slug":"linux","count":1,"path":"api/categories/linux.json"}],"tags":[{"name":"cpp","slug":"cpp","count":4,"path":"api/tags/cpp.json"}],"toc":"<ol class=\"toc\"><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#demo\"><span class=\"toc-text\">demo</span></a></li></ol>","author":{"name":"NoleHuan","slug":"blog-author","avatar":"/img/tennis_logo.svg","link":"/","description":"The true nature of a heart is seen in its response to the unattractive.","socials":{"github":"https://github.com/nolehuan","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"https://weibo.com/u/5948495997","zhihu":"","csdn":"","juejin":"","customs":{}}},"mapped":true,"hidden":false,"prev_post":{},"next_post":{"title":"op","uid":"7790d923d44c9f611a31c98e9aa24f9f","slug":"linux/op","date":"2023-12-02T20:00:29.000Z","updated":"2023-12-09T07:25:46.545Z","comments":true,"path":"api/articles/linux/op.json","cover":null,"text":"optimise...","permalink":"/post/linux/op","photos":[],"count_time":{"symbolsCount":421,"symbolsTime":"1 mins."},"categories":[{"name":"coding","slug":"coding","count":4,"path":"api/categories/coding.json"}],"tags":[{"name":"cpp","slug":"cpp","count":4,"path":"api/tags/cpp.json"}],"author":{"name":"NoleHuan","slug":"blog-author","avatar":"/img/tennis_logo.svg","link":"/","description":"The true nature of a heart is seen in its response to the unattractive.","socials":{"github":"https://github.com/nolehuan","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"https://weibo.com/u/5948495997","zhihu":"","csdn":"","juejin":"","customs":{}}},"feature":true}}